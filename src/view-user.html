<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="polython-challenge-item.html">
<link rel="import" href="shared-styles.html">

<dom-module id="view-user">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>

    <firebase-document
      path="/activeChallenge"
      data="{{currentChallengeId}}">
    </firebase-document>

    <firebase-query
      id="currentChallenge"
      path="[[pathCurrentChallenge]]"
      data="{{currentCallenge}}">
    </firebase-query>    

    <firebase-query
      id="pastChallenges"
      path="/challenges"
      data="{{challenges}}">
    </firebase-query>    


    <p>Reto actual <a href="/reto">reto</a></p>
    <polython-challenge-item
      title=[[currentCallenge.title]]
      description=[[currentCallenge.description]]
      start-time=[[currentCallenge.startTime]]
      end-time=[[currentCallenge.endTime]]
      execution-time=[[currentCallenge.executionTime]]
      picture-href=[[currentCallenge.pictureHref]]
      location=[[currentCallenge.location]] >
    </polython-challenge-item>

    <p>Retos pasados</p>
    <iron-list items="[[challenges]]" >
      <template>
        <polython-challenge-item
         title=[[item.title]]
         description=[[item.description]]
         start-time=[[item.startTime]]
         end-time=[[item.endTime]]
         execution-time=[[item.executionTime]]
         picture-href=[[item.pictureHref]]
         location=[[item.location]]
         active=[[item.active]]
        >
        </polython-challenge-item>
      </template>
    </iron-list>
  </template>

  <script>
    class ViewUser extends Polymer.Element {
      static get is() { return 'view-user'; }

      static get properties() {
        return {
          currentChallengeId: {
            type: 'String'
          },
          pathCurrentChallenge: {
            type: 'String',
            computed: '_computePathForCurrentChallenge(currentChallengeId)'
          },
          currentChallenge: {
            type: 'Object',
          },
          challenges: {
            type: 'Array'
          }
        }
      }

      _computePathForCurrentChallenge(currentChallengeId) {
        if (currentChallengeId instanceof String) {
          return '/challenges/' + currentChallengeId;
        } else {
          return '';
        }
      }

      _getChallenges() {
        return [
          {
            title: 'Checkpoint con mariachi',
            description: 'Hazte una foto con el android Mariachi',
            startTime: '13:00',
            endTime: '13:30',
            executionTime: '13:05',
            location: 'x, y',
            pictureHref: 'https://1.bp.blogspot.com/-LqjVHEyDImU/V7buZvy_P_I/AAAAAAAAIeQ/YzrvMSnd06YDwf7heYz53qMg6rEm5GJWACLcB/s640/14045890_318329811851920_8508340804919828659_n.jpg',
            active: true
          },
          {
            title: 'Checkpoint goloso',
            description: 'Hazte una foto comiendo chocolates',
            startTime: '15:00',
            endTime: '15:30',
            executionTime: '15:21',
            location: 'x, y',
            pictureHref: 'http://www.bellabeat.com/blog/media/Indulging-in-a-sweet-affair-with-chocolate-000048186060_Small.jpg',
            active: false
          },          
          {
            title: 'Checkpoint con frida',
            description: 'Hazte una foto con el logo de Frida',
            startTime: '17:00',
            endTime: '17:30',
            executionTime: undefined,
            location: undefined,
            active: false
          }          
        ]
      }
    }

    window.customElements.define(ViewUser.is, ViewUser);
  </script>
</dom-module>
